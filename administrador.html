<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador - Mayckol Jimenez</title>
    <script>
        (function() {
            // Verifica si la página fue redirigida desde autorizado.html
            const referrer = document.referrer;
            if (!referrer.includes("autorizado.html")) {
                // Redirige a index.html si no proviene de autorizado.html
                window.location.href = "index.html";
            }
        })();
    </script>
      
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome para íconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Estilos personalizados */
        :root {
            --color-success: #28a745;
            --color-warning: #ffc107;
            --color-info: #17a2b8;
            --color-primary: #007bff;
            --color-danger: #dc3545;

            /* Paleta de colores suaves y modernos */
            --color-bg: #f7f9fc;
            --color-text: #333;
            --color-accent: #3c6e71;
            --color-light: #ffffff;
            --color-dark: #0b132b;
            --color-border: #d1d9e6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-bg);
            margin: 0;
            padding: 20px;
            color: var(--color-text);
        }

        h1 {
            text-align: center;
            color: var(--color-dark);
            margin-bottom: 40px;
            font-weight: 700;
        }

        /* Contenedores principales */
        .container-fluid {
            max-width: 1200px;
            margin: auto;
            background: var(--color-light);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
        }

        /* Botones principales */
        .btn {
            border-radius: 30px;
            font-weight: 500;
        }

        /* Botones de acción (editar/eliminar) */
        .btn-accion {
            margin-right: 5px;
        }

        /* Tabs */
        .nav-tabs .nav-link {
            border-radius: 30px 30px 0 0;
            margin-right: 5px;
            color: var(--color-dark);
            font-weight: 500;
            background: #e9edf3;
            border: none;
            padding: 10px 20px;
        }

        .nav-tabs .nav-link.active {
            background: var(--color-accent);
            color: #fff;
        }

        /* Tab content */
        .tab-content {
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            padding: 20px;
            margin-top: -1px;
        }

        /* Tablas */
        .tabla-admin {
            margin-top: 20px;
            border-collapse: separate;
            border-spacing: 0;
        }

        .tabla-admin thead {
            background: var(--color-accent);
            color: #fff;
        }

        .tabla-admin th, .tabla-admin td {
            vertical-align: middle;
            border-bottom: 1px solid var(--color-border);
            padding: 12px;
        }

        .tabla-admin tbody tr:hover {
            background: #f1f5f9;
        }

        /* Imágenes */
        .img-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            border: none;
            box-shadow: 0 0 3px rgba(0,0,0,0.1);
        }

        /* Mensajes */
        .mensaje {
            display: none;
            margin-top: 15px;
        }

        /* Previsualización de imagen */
        .previsualizacion-img {
            width: 100%;
            height: auto;
            max-height: 200px;
            object-fit: cover;
            margin-bottom: 15px;
            display: none;
            border-radius: 5px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }

        /* Modales */
        .modal-header {
            border-bottom: none;
        }

        .modal-header h5 {
            font-weight: 600;
        }

        .modal-content {
            border-radius: 10px;
        }

        .modal-body .form-label {
            font-weight: 500;
        }

        .modal-body input, .modal-body textarea {
            border-radius: 5px;
            border: 1px solid var(--color-border);
        }

        .modal-footer {
            border-top: none;
        }

        .btn-close {
            outline: none;
        }

        /* Hover en botones de acción */
        .btn-accion:hover {
            opacity: 0.9;
        }

        /* Ajustes en los formularios */
        #form-cursos, #form-editar-curso,
        #form-videos, #form-editar-video,
        #form-enlaces, #form-editar-enlace {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1>Panel de Administración</h1>

        <!-- Botones para agregar nuevos elementos -->
        <div class="d-flex flex-wrap justify-content-center mb-4">
            <button class="btn btn-success me-3 mb-2" data-bs-toggle="modal" data-bs-target="#modal-cursos">
                <i class="fas fa-plus me-2"></i>Agregar Curso
            </button>
            <button class="btn btn-warning me-3 mb-2" data-bs-toggle="modal" data-bs-target="#modal-videos">
                <i class="fas fa-plus me-2"></i>Agregar Video
            </button>
            <button class="btn btn-info mb-2" data-bs-toggle="modal" data-bs-target="#modal-enlaces">
                <i class="fas fa-plus me-2"></i>Agregar Enlace Útil
            </button>
        </div>

        <!-- Tabs para gestionar Cursos, Videos y Enlaces -->
        <ul class="nav nav-tabs justify-content-center" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="cursos-tab" data-bs-toggle="tab" data-bs-target="#cursos" type="button" role="tab" aria-controls="cursos" aria-selected="true">
                    <i class="fas fa-book me-2"></i>Cursos
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="videos-tab" data-bs-toggle="tab" data-bs-target="#videos" type="button" role="tab" aria-controls="videos" aria-selected="false">
                    <i class="fas fa-video me-2"></i>Videos
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="enlaces-tab" data-bs-toggle="tab" data-bs-target="#enlaces" type="button" role="tab" aria-controls="enlaces" aria-selected="false">
                    <i class="fas fa-link me-2"></i>Enlaces Útiles
                </button>
            </li>
        </ul>
        <div class="tab-content" id="adminTabsContent">
            <!-- Tab de Cursos -->
            <div class="tab-pane fade show active" id="cursos" role="tabpanel" aria-labelledby="cursos-tab">
                <table class="table tabla-admin mt-3">
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Nombre</th>
                            <th>Descripción</th>
                            <th>Enlace de Video</th>
                            <th>Temas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="lista-cursos">
                        <!-- Filas de cursos se insertarán aquí dinámicamente -->
                    </tbody>
                </table>
            </div>
            <!-- Tab de Videos -->
            <div class="tab-pane fade" id="videos" role="tabpanel" aria-labelledby="videos-tab">
                <table class="table tabla-admin mt-3">
                    <thead>
                        <tr>
                            <th>Título</th>
                            <th>Descripción</th>
                            <th>Enlace de YouTube</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="lista-videos">
                        <!-- Filas de videos se insertarán aquí dinámicamente -->
                    </tbody>
                </table>
            </div>
            <!-- Tab de Enlaces -->
            <div class="tab-pane fade" id="enlaces" role="tabpanel" aria-labelledby="enlaces-tab">
                <table class="table tabla-admin mt-3">
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Título</th>
                            <th>Descripción</th>
                            <th>URL</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="lista-enlaces">
                        <!-- Filas de enlaces se insertarán aquí dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Modales para Agregar y Editar -->
        <!-- Modal Agregar Curso -->
        <div class="modal fade" id="modal-cursos" tabindex="-1" aria-labelledby="modal-cursos-label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title" id="modal-cursos-label"><i class="fas fa-book me-2"></i>Agregar Nuevo Curso</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-cursos">
                            <div class="mb-3">
                                <label for="nombre-curso" class="form-label">Nombre del Curso</label>
                                <input type="text" class="form-control" id="nombre-curso" required>
                            </div>
                            <div class="mb-3">
                                <label for="descripcion-curso" class="form-label">Descripción</label>
                                <textarea class="form-control" id="descripcion-curso" rows="3" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="enlace-video-curso" class="form-label">Enlace del Video</label>
                                <input type="url" class="form-control" id="enlace-video-curso" required>
                            </div>
                            <div class="mb-3">
                                <label for="temas-curso" class="form-label">Temas (separados por comas)</label>
                                <input type="text" class="form-control" id="temas-curso" required>
                            </div>
                            <div class="mb-3">
                                <label for="imagen-curso" class="form-label">Imagen del Curso</label>
                                <input type="file" class="form-control" id="imagen-curso" accept="image/*" required>
                                <img id="previsualizacion-img-curso" class="previsualizacion-img" alt="Previsualización de la Imagen">
                            </div>
                            <button type="submit" class="btn btn-success w-100"><i class="fas fa-plus me-2"></i>Agregar Curso</button>
                            <div id="mensaje-cursos" class="mensaje"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Editar Curso -->
        <div class="modal fade" id="modal-editar-curso" tabindex="-1" aria-labelledby="modal-editar-curso-label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="modal-editar-curso-label"><i class="fas fa-edit me-2"></i>Editar Curso</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-editar-curso">
                            <input type="hidden" id="id-curso">
                            <div class="mb-3">
                                <label for="editar-nombre-curso" class="form-label">Nombre del Curso</label>
                                <input type="text" class="form-control" id="editar-nombre-curso" required>
                            </div>
                            <div class="mb-3">
                                <label for="editar-descripcion-curso" class="form-label">Descripción</label>
                                <textarea class="form-control" id="editar-descripcion-curso" rows="3" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="editar-enlace-video-curso" class="form-label">Enlace del Video</label>
                                <input type="url" class="form-control" id="editar-enlace-video-curso" required>
                            </div>
                            <div class="mb-3">
                                <label for="editar-temas-curso" class="form-label">Temas (separados por comas)</label>
                                <input type="text" class="form-control" id="editar-temas-curso" required>
                            </div>
                            <div class="mb-3">
                                <label for="editar-imagen-curso" class="form-label">Imagen del Curso</label>
                                <input type="file" class="form-control" id="editar-imagen-curso" accept="image/*">
                                <img id="previsualizacion-img-editar-curso" class="previsualizacion-img" alt="Previsualización de la Imagen">
                            </div>
                            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-save me-2"></i>Guardar Cambios</button>
                            <div id="mensaje-editar-cursos" class="mensaje"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Agregar Video -->
        <div class="modal fade" id="modal-videos" tabindex="-1" aria-labelledby="modal-videos-label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-warning text-white">
                        <h5 class="modal-title" id="modal-videos-label"><i class="fas fa-video me-2"></i>Agregar Nuevo Video</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-videos">
                            <div class="mb-3">
                                <label for="titulo-video" class="form-label">Título del Video</label>
                                <input type="text" class="form-control" id="titulo-video" required>
                            </div>
                            <div class="mb-3">
                                <label for="descripcion-video" class="form-label">Descripción</label>
                                <textarea class="form-control" id="descripcion-video" rows="3" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="enlace-video" class="form-label">Enlace de YouTube</label>
                                <input type="url" class="form-control" id="enlace-video" required>
                            </div>
                            <button type="submit" class="btn btn-warning w-100"><i class="fas fa-plus me-2"></i>Agregar Video</button>
                            <div id="mensaje-videos" class="mensaje"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Editar Video -->
        <div class="modal fade" id="modal-editar-video" tabindex="-1" aria-labelledby="modal-editar-video-label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="modal-editar-video-label"><i class="fas fa-edit me-2"></i>Editar Video</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-editar-video">
                            <input type="hidden" id="id-video">
                            <div class="mb-3">
                                <label for="editar-titulo-video" class="form-label">Título del Video</label>
                                <input type="text" class="form-control" id="editar-titulo-video" required>
                            </div>
                            <div class="mb-3">
                                <label for="editar-descripcion-video" class="form-label">Descripción</label>
                                <textarea class="form-control" id="editar-descripcion-video" rows="3" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="editar-enlace-video" class="form-label">Enlace de YouTube</label>
                                <input type="url" class="form-control" id="editar-enlace-video" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-save me-2"></i>Guardar Cambios</button>
                            <div id="mensaje-editar-videos" class="mensaje"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Agregar Enlace -->
        <div class="modal fade" id="modal-enlaces" tabindex="-1" aria-labelledby="modal-enlaces-label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-info text-white">
                        <h5 class="modal-title" id="modal-enlaces-label"><i class="fas fa-link me-2"></i>Agregar Nuevo Enlace Útil</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-enlaces">
                            <div class="mb-3">
                                <label for="titulo-enlace" class="form-label">Título del Enlace</label>
                                <input type="text" class="form-control" id="titulo-enlace" required>
                            </div>
                            <div class="mb-3">
                                <label for="descripcion-enlace" class="form-label">Descripción</label>
                                <textarea class="form-control" id="descripcion-enlace" rows="3" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="url-enlace" class="form-label">URL</label>
                                <input type="url" class="form-control" id="url-enlace" required>
                            </div>
                            <!-- Campo adicional para la subida de imagen -->
                            <div class="mb-3">
                                <label for="imagen-enlace" class="form-label">Imagen del Enlace (opcional)</label>
                                <input type="file" class="form-control" id="imagen-enlace" accept="image/*">
                                <img id="previsualizacion-img-enlace" class="previsualizacion-img" alt="Previsualización de la Imagen"> 
                            </div>
                            <button type="submit" class="btn btn-info w-100"><i class="fas fa-plus me-2"></i>Agregar Enlace</button>
                            <div id="mensaje-enlaces" class="mensaje"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Editar Enlace -->
        <div class="modal fade" id="modal-editar-enlace" tabindex="-1" aria-labelledby="modal-editar-enlace-label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="modal-editar-enlace-label"><i class="fas fa-edit me-2"></i>Editar Enlace Útil</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-editar-enlace">
                            <input type="hidden" id="id-enlace">
                            <div class="mb-3">
                                <label for="editar-titulo-enlace" class="form-label">Título del Enlace</label>
                                <input type="text" class="form-control" id="editar-titulo-enlace" required>
                            </div>
                            <div class="mb-3">
                                <label for="editar-descripcion-enlace" class="form-label">Descripción</label>
                                <textarea class="form-control" id="editar-descripcion-enlace" rows="3" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="editar-url-enlace" class="form-label">URL</label>
                                <input type="url" class="form-control" id="editar-url-enlace" required>
                            </div>
                            <!-- Campo adicional para la subida de imagen -->
                            <div class="mb-3">
                                <label for="editar-imagen-enlace" class="form-label">Imagen del Enlace (opcional)</label>
                                <input type="file" class="form-control" id="editar-imagen-enlace" accept="image/*">
                                <img id="previsualizacion-img-editar-enlace" class="previsualizacion-img" alt="Previsualización de la Imagen"> 
                            </div>
                            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-save me-2"></i>Guardar Cambios</button>
                            <div id="mensaje-editar-enlaces" class="mensaje"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS y Dependencias -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Firebase SDK (Modular) -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
            import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

            // Configuración de Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyA3p9Vs9zhre-kcxTGbEsjLOEP9Y8At_2Y",
                authDomain: "mayckoljimenez-4a37a.firebaseapp.com",
                projectId: "mayckoljimenez-4a37a",
                storageBucket: "mayckoljimenez-4a37a.appspot.com",
                messagingSenderId: "181734742325",
                appId: "1:181734742325:web:7b954c291745c81777947c",
                measurementId: "G-CTSD2L8QD7"
            };

            // Inicializar Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            // Clave API de ImgBB (Reemplaza con tu propia API Key)
            const imgbbAPIKey = "17ecb33d7cf86647046260a9a2a7881e";

            // Función para convertir archivo a base64
            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                    reader.onerror = error => reject(error);
                });
            }

            // Función para subir imagen a ImgBB
            async function subirImagen(file) {
                try {
                    const base64Image = await fileToBase64(file);
                    const formData = new FormData();
                    formData.append('image', base64Image);
                    
                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbAPIKey}`, {
                        method: "POST",
                        body: formData
                    });
                    const result = await response.json();
                    if (result.success) {
                        return result.data.url;
                    } else {
                        throw new Error(result.error.message);
                    }
                } catch (error) {
                    console.error("Error al subir la imagen:", error);
                    throw error;
                }
            }

            // Función para mostrar mensajes de feedback
            function mostrarMensaje(elementId, mensaje, tipo) {
                const mensajeElemento = document.getElementById(elementId);
                mensajeElemento.className = `mensaje alert ${tipo === 'exito' ? 'alert-success' : 'alert-danger'}`;
                mensajeElemento.textContent = mensaje;
                mensajeElemento.style.display = 'block';

                setTimeout(() => {
                    mensajeElemento.style.display = 'none';
                }, 5000);
            }

            // Funciones de obtención de datos
            async function obtenerCursos() {
                try {
                    const cursosRef = collection(db, "cursos");
                    const snapshot = await getDocs(cursosRef);
                    const listaCursos = document.getElementById("lista-cursos");
                    listaCursos.innerHTML = "";

                    snapshot.forEach(docu => {
                        const curso = docu.data();
                        listaCursos.innerHTML += `
                            <tr>
                                <td>
                                    <img src="${curso.imagen_url || 'https://via.placeholder.com/60'}" alt="${curso.nombre}" class="img-thumbnail">
                                </td>
                                <td>${curso.nombre}</td>
                                <td>${curso.descripcion}</td>
                                <td><a href="${curso.enlace_video}" target="_blank" style="color: var(--color-accent)">Ver Video</a></td>
                                <td>${(curso.temas || []).join(', ')}</td>
                                <td>
                                    <button class="btn btn-sm btn-primary btn-accion editar-curso" 
                                        data-id="${docu.id}" 
                                        data-nombre="${curso.nombre.replace(/"/g, '&quot;')}" 
                                        data-descripcion="${curso.descripcion.replace(/"/g, '&quot;')}" 
                                        data-enlace_video="${curso.enlace_video}" 
                                        data-temas="${(curso.temas || []).join(', ')}" 
                                        data-imagen_url="${curso.imagen_url || ''}">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="btn btn-sm btn-danger btn-accion eliminar-curso" 
                                        data-id="${docu.id}" 
                                        data-imagen_url="${curso.imagen_url || ''}">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </td>
                            </tr>
                        `;
                    });

                    agregarListenersCursos();
                } catch (error) {
                    console.error("Error al obtener cursos:", error);
                    mostrarMensaje('mensaje-cursos', 'Error al cargar los cursos.', 'alert-danger');
                }
            }

            async function obtenerVideos() {
                try {
                    const videosRef = collection(db, "videos");
                    const snapshot = await getDocs(videosRef);
                    const listaVideos = document.getElementById("lista-videos");
                    listaVideos.innerHTML = "";

                    snapshot.forEach(docu => {
                        const video = docu.data();
                        listaVideos.innerHTML += `
                            <tr>
                                <td>${video.titulo}</td>
                                <td>${video.descripcion}</td>
                                <td><a href="${video.enlace}" target="_blank" style="color: var(--color-accent)">Ver en YouTube</a></td>
                                <td>
                                    <button class="btn btn-sm btn-primary btn-accion editar-video" 
                                        data-id="${docu.id}" 
                                        data-titulo="${video.titulo.replace(/"/g, '&quot;')}" 
                                        data-descripcion="${video.descripcion.replace(/"/g, '&quot;')}" 
                                        data-enlace="${video.enlace}">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="btn btn-sm btn-danger btn-accion eliminar-video" 
                                        data-id="${docu.id}">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </td>
                            </tr>
                        `;
                    });

                    agregarListenersVideos();
                } catch (error) {
                    console.error("Error al obtener videos:", error);
                    mostrarMensaje('mensaje-videos', 'Error al cargar los videos.', 'alert-danger');
                }
            }

            async function obtenerEnlaces() {
                try {
                    const enlacesRef = collection(db, "enlaces");
                    const snapshot = await getDocs(enlacesRef);
                    const listaEnlaces = document.getElementById("lista-enlaces");
                    listaEnlaces.innerHTML = "";

                    snapshot.forEach(docu => {
                        const enlace = docu.data();
                        listaEnlaces.innerHTML += `
                            <tr>
                                <td>
                                    ${enlace.imagen_url ? `<img src="${enlace.imagen_url}" alt="${enlace.titulo}" class="img-thumbnail">` : 'No Disponible'}
                                </td>
                                <td>${enlace.titulo}</td>
                                <td>${enlace.descripcion}</td>
                                <td><a href="${enlace.url}" target="_blank" style="color: var(--color-accent)">Acceder</a></td>
                                <td>
                                    <button class="btn btn-sm btn-primary btn-accion editar-enlace" 
                                        data-id="${docu.id}" 
                                        data-titulo="${enlace.titulo.replace(/"/g, '&quot;')}" 
                                        data-descripcion="${enlace.descripcion.replace(/"/g, '&quot;')}" 
                                        data-url="${enlace.url}" 
                                        data-imagen_url="${enlace.imagen_url || ''}">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="btn btn-sm btn-danger btn-accion eliminar-enlace" 
                                        data-id="${docu.id}" 
                                        data-imagen_url="${enlace.imagen_url || ''}">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </td>
                            </tr>
                        `;
                    });

                    agregarListenersEnlaces();
                } catch (error) {
                    console.error("Error al obtener enlaces:", error);
                    mostrarMensaje('mensaje-enlaces', 'Error al cargar los enlaces.', 'alert-danger');
                }
            }

            // Listeners
            function agregarListenersCursos() {
                const botonesEditar = document.querySelectorAll('.editar-curso');
                botonesEditar.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        const nombre = btn.getAttribute('data-nombre');
                        const descripcion = btn.getAttribute('data-descripcion');
                        const enlace_video = btn.getAttribute('data-enlace_video');
                        const temas = btn.getAttribute('data-temas');
                        const imagen_url = btn.getAttribute('data-imagen_url');

                        document.getElementById('id-curso').value = id;
                        document.getElementById('editar-nombre-curso').value = nombre;
                        document.getElementById('editar-descripcion-curso').value = descripcion;
                        document.getElementById('editar-enlace-video-curso').value = enlace_video;
                        document.getElementById('editar-temas-curso').value = temas;

                        const previsualizacionImg = document.getElementById('previsualizacion-img-editar-curso');
                        if (imagen_url) {
                            previsualizacionImg.src = imagen_url;
                            previsualizacionImg.style.display = 'block';
                        } else {
                            previsualizacionImg.src = '';
                            previsualizacionImg.style.display = 'none';
                        }

                        const modalEditarCurso = new bootstrap.Modal(document.getElementById('modal-editar-curso'));
                        modalEditarCurso.show();
                    });
                });

                const botonesEliminar = document.querySelectorAll('.eliminar-curso');
                botonesEliminar.forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const id = btn.getAttribute('data-id');
                        const imagen_url = btn.getAttribute('data-imagen_url');
                        if (confirm('¿Estás seguro de que deseas eliminar este curso?')) {
                            try {
                                // Eliminar imagen de ImgBB si existe
                                if (imagen_url) {
                                    // Nota: ImgBB no ofrece una API para eliminar imágenes, por lo que este paso puede no ser posible.
                                    console.warn('ImgBB no soporta eliminación de imágenes vía API.');
                                }

                                await deleteDoc(doc(db, 'cursos', id));
                                obtenerCursos();
                                mostrarMensaje('mensaje-cursos', 'Curso eliminado exitosamente.', 'exito');
                            } catch (error) {
                                console.error("Error al eliminar el curso:", error);
                                mostrarMensaje('mensaje-cursos', 'Error al eliminar el curso.', 'alert-danger');
                            }
                        }
                    });
                });
            }

            function agregarListenersVideos() {
                const botonesEditar = document.querySelectorAll('.editar-video');
                botonesEditar.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        const titulo = btn.getAttribute('data-titulo');
                        const descripcion = btn.getAttribute('data-descripcion');
                        const enlace = btn.getAttribute('data-enlace');

                        document.getElementById('id-video').value = id;
                        document.getElementById('editar-titulo-video').value = titulo;
                        document.getElementById('editar-descripcion-video').value = descripcion;
                        document.getElementById('editar-enlace-video').value = enlace;

                        const modalEditarVideo = new bootstrap.Modal(document.getElementById('modal-editar-video'));
                        modalEditarVideo.show();
                    });
                });

                const botonesEliminar = document.querySelectorAll('.eliminar-video');
                botonesEliminar.forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const id = btn.getAttribute('data-id');
                        if (confirm('¿Estás seguro de que deseas eliminar este video?')) {
                            try {
                                await deleteDoc(doc(db, 'videos', id));
                                obtenerVideos();
                                mostrarMensaje('mensaje-videos', 'Video eliminado exitosamente.', 'exito');
                            } catch (error) {
                                console.error("Error al eliminar el video:", error);
                                mostrarMensaje('mensaje-videos', 'Error al eliminar el video.', 'alert-danger');
                            }
                        }
                    });
                });
            }

            function agregarListenersEnlaces() {
                const botonesEditar = document.querySelectorAll('.editar-enlace');
                botonesEditar.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        const titulo = btn.getAttribute('data-titulo');
                        const descripcion = btn.getAttribute('data-descripcion');
                        const url = btn.getAttribute('data-url');
                        const imagen_url = btn.getAttribute('data-imagen_url');

                        document.getElementById('id-enlace').value = id;
                        document.getElementById('editar-titulo-enlace').value = titulo;
                        document.getElementById('editar-descripcion-enlace').value = descripcion;
                        document.getElementById('editar-url-enlace').value = url;

                        const previsualizacionImg = document.getElementById('previsualizacion-img-editar-enlace');
                        if (imagen_url) {
                            previsualizacionImg.src = imagen_url;
                            previsualizacionImg.style.display = 'block';
                        } else {
                            previsualizacionImg.src = '';
                            previsualizacionImg.style.display = 'none';
                        }

                        const modalEditarEnlace = new bootstrap.Modal(document.getElementById('modal-editar-enlace'));
                        modalEditarEnlace.show();
                    });
                });

                const botonesEliminar = document.querySelectorAll('.eliminar-enlace');
                botonesEliminar.forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const id = btn.getAttribute('data-id');
                        const imagen_url = btn.getAttribute('data-imagen_url');
                        if (confirm('¿Estás seguro de que deseas eliminar este enlace?')) {
                            try {
                                // Eliminar imagen de ImgBB si existe
                                if (imagen_url) {
                                    // Nota: ImgBB no ofrece una API para eliminar imágenes, por lo que este paso puede no ser posible.
                                    console.warn('ImgBB no soporta eliminación de imágenes vía API.');
                                }

                                await deleteDoc(doc(db, 'enlaces', id));
                                obtenerEnlaces();
                                mostrarMensaje('mensaje-enlaces', 'Enlace eliminado exitosamente.', 'exito');
                            } catch (error) {
                                console.error("Error al eliminar el enlace:", error);
                                mostrarMensaje('mensaje-enlaces', 'Error al eliminar el enlace.', 'alert-danger');
                            }
                        }
                    });
                });
            }

            // Formularios: Agregar
            document.getElementById('form-cursos').addEventListener('submit', async function(e) {
                e.preventDefault();

                const nombre = document.getElementById('nombre-curso').value.trim();
                const descripcion = document.getElementById('descripcion-curso').value.trim();
                const enlaceVideo = document.getElementById('enlace-video-curso').value.trim();
                const temasInput = document.getElementById('temas-curso').value.trim();
                const temas = temasInput.split(',').map(tema => tema.trim()).filter(Boolean);
                const imagenInput = document.getElementById('imagen-curso');
                const imagenFile = imagenInput.files[0];

                if (nombre && descripcion && enlaceVideo && temas.length > 0 && imagenFile) {
                    try {
                        // Subir imagen a ImgBB
                        const imagenURL = await subirImagen(imagenFile);

                        // Agregar curso a Firestore
                        await addDoc(collection(db, 'cursos'), {
                            nombre,
                            descripcion,
                            enlace_video: enlaceVideo,
                            temas,
                            imagen_url: imagenURL
                        });

                        mostrarMensaje('mensaje-cursos', 'Curso agregado exitosamente.', 'exito');
                        this.reset();
                        document.getElementById('previsualizacion-img-curso').style.display = 'none';
                        const modalCursos = bootstrap.Modal.getInstance(document.getElementById('modal-cursos'));
                        modalCursos.hide();
                        obtenerCursos();
                    } catch (error) {
                        mostrarMensaje('mensaje-cursos', 'Error al agregar el curso. Inténtalo de nuevo.', 'alert-danger');
                    }
                } else {
                    mostrarMensaje('mensaje-cursos', 'Por favor, completa todos los campos.', 'alert-danger');
                }
            });

            document.getElementById('form-videos').addEventListener('submit', async function(e) {
                e.preventDefault();

                const titulo = document.getElementById('titulo-video').value.trim();
                const descripcion = document.getElementById('descripcion-video').value.trim();
                const enlace = document.getElementById('enlace-video').value.trim();

                if (titulo && descripcion && enlace) {
                    try {
                        await addDoc(collection(db, 'videos'), {
                            titulo,
                            descripcion,
                            enlace
                        });
                        mostrarMensaje('mensaje-videos', 'Video agregado exitosamente.', 'exito');
                        this.reset();
                        const modalVideos = bootstrap.Modal.getInstance(document.getElementById('modal-videos'));
                        modalVideos.hide();
                        obtenerVideos();
                    } catch (error) {
                        console.error("Error al agregar el video:", error);
                        mostrarMensaje('mensaje-videos', 'Error al agregar el video. Inténtalo de nuevo.', 'alert-danger');
                    }
                } else {
                    mostrarMensaje('mensaje-videos', 'Por favor, completa todos los campos.', 'alert-danger');
                }
            });

            document.getElementById('form-enlaces').addEventListener('submit', async function(e) {
                e.preventDefault();

                const titulo = document.getElementById('titulo-enlace').value.trim();
                const descripcion = document.getElementById('descripcion-enlace').value.trim();
                const url = document.getElementById('url-enlace').value.trim();
                const imagenInput = document.getElementById('imagen-enlace');
                const imagenFile = imagenInput.files[0];

                try {
                    let imagenURL = '';
                    if (imagenFile) {
                        imagenURL = await subirImagen(imagenFile);
                    }

                    if (titulo && descripcion && url) {
                        await addDoc(collection(db, 'enlaces'), {
                            titulo,
                            descripcion,
                            url,
                            imagen_url: imagenURL || null
                        });
                        mostrarMensaje('mensaje-enlaces', 'Enlace agregado exitosamente.', 'exito');
                        this.reset();
                        document.getElementById('previsualizacion-img-enlace').style.display = 'none';
                        const modalEnlaces = bootstrap.Modal.getInstance(document.getElementById('modal-enlaces'));
                        modalEnlaces.hide();
                        obtenerEnlaces();
                    } else {
                        mostrarMensaje('mensaje-enlaces', 'Por favor, completa todos los campos obligatorios.', 'alert-danger');
                    }
                } catch (error) {
                    console.error("Error al agregar el enlace:", error);
                    mostrarMensaje('mensaje-enlaces', 'Error al agregar el enlace. Inténtalo de nuevo.', 'alert-danger');
                }
            });

            // Formularios: Editar
            document.getElementById('form-editar-curso').addEventListener('submit', async function(e) {
                e.preventDefault();

                const id = document.getElementById('id-curso').value;
                const nombre = document.getElementById('editar-nombre-curso').value.trim();
                const descripcion = document.getElementById('editar-descripcion-curso').value.trim();
                const enlaceVideo = document.getElementById('editar-enlace-video-curso').value.trim();
                const temasInput = document.getElementById('editar-temas-curso').value.trim();
                const temas = temasInput.split(',').map(tema => tema.trim()).filter(Boolean);
                const imagenInput = document.getElementById('editar-imagen-curso');
                const imagenFile = imagenInput.files[0];

                try {
                    let imagenURL = document.getElementById('previsualizacion-img-editar-curso').src;
                    if (imagenFile) {
                        imagenURL = await subirImagen(imagenFile);
                    }

                    if (nombre && descripcion && enlaceVideo && temas.length > 0 && imagenURL) {
                        const cursoDoc = doc(db, 'cursos', id);
                        await updateDoc(cursoDoc, {
                            nombre,
                            descripcion,
                            enlace_video: enlaceVideo,
                            temas,
                            imagen_url: imagenURL
                        });
                        mostrarMensaje('mensaje-editar-cursos', 'Curso actualizado exitosamente.', 'exito');
                        const modalEditarCurso = bootstrap.Modal.getInstance(document.getElementById('modal-editar-curso'));
                        modalEditarCurso.hide();
                        obtenerCursos();
                    } else {
                        mostrarMensaje('mensaje-editar-cursos', 'Por favor, completa todos los campos.', 'alert-danger');
                    }
                } catch (error) {
                    console.error("Error al actualizar el curso:", error);
                    mostrarMensaje('mensaje-editar-cursos', 'Error al actualizar el curso. Inténtalo de nuevo.', 'alert-danger');
                }
            });

            document.getElementById('form-editar-video').addEventListener('submit', async function(e) {
                e.preventDefault();

                const id = document.getElementById('id-video').value;
                const titulo = document.getElementById('editar-titulo-video').value.trim();
                const descripcion = document.getElementById('editar-descripcion-video').value.trim();
                const enlace = document.getElementById('editar-enlace-video').value.trim();

                if (titulo && descripcion && enlace) {
                    try {
                        const videoDoc = doc(db, 'videos', id);
                        await updateDoc(videoDoc, {
                            titulo,
                            descripcion,
                            enlace
                        });
                        mostrarMensaje('mensaje-editar-videos', 'Video actualizado exitosamente.', 'exito');
                        const modalEditarVideo = bootstrap.Modal.getInstance(document.getElementById('modal-editar-video'));
                        modalEditarVideo.hide();
                        obtenerVideos();
                    } catch (error) {
                        console.error("Error al actualizar el video:", error);
                        mostrarMensaje('mensaje-editar-videos', 'Error al actualizar el video. Inténtalo de nuevo.', 'alert-danger');
                    }
                } else {
                    mostrarMensaje('mensaje-editar-videos', 'Por favor, completa todos los campos.', 'alert-danger');
                }
            });

            document.getElementById('form-editar-enlace').addEventListener('submit', async function(e) {
                e.preventDefault();

                const id = document.getElementById('id-enlace').value;
                const titulo = document.getElementById('editar-titulo-enlace').value.trim();
                const descripcion = document.getElementById('editar-descripcion-enlace').value.trim();
                const url = document.getElementById('editar-url-enlace').value.trim();
                const imagenInput = document.getElementById('editar-imagen-enlace');
                const imagenFile = imagenInput.files[0];

                try {
                    let imagenURL = document.getElementById('previsualizacion-img-editar-enlace').src;
                    if (imagenFile) {
                        imagenURL = await subirImagen(imagenFile);
                    }

                    if (titulo && descripcion && url) {
                        const enlaceDoc = doc(db, 'enlaces', id);
                        await updateDoc(enlaceDoc, {
                            titulo,
                            descripcion,
                            url,
                            imagen_url: imagenURL || null
                        });
                        mostrarMensaje('mensaje-editar-enlaces', 'Enlace actualizado exitosamente.', 'exito');
                        const modalEditarEnlace = bootstrap.Modal.getInstance(document.getElementById('modal-editar-enlace'));
                        modalEditarEnlace.hide();
                        obtenerEnlaces();
                    } else {
                        mostrarMensaje('mensaje-editar-enlaces', 'Por favor, completa todos los campos obligatorios.', 'alert-danger');
                    }
                } catch (error) {
                    console.error("Error al actualizar el enlace:", error);
                    mostrarMensaje('mensaje-editar-enlaces', 'Error al actualizar el enlace. Inténtalo de nuevo.', 'alert-danger');
                }
            });

            // Previsualización de imagen
            document.getElementById('imagen-curso').addEventListener('change', function() {
                const file = this.files[0];
                const previsualizacionImg = document.getElementById('previsualizacion-img-curso');
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previsualizacionImg.src = e.target.result;
                        previsualizacionImg.style.display = 'block';
                    }
                    reader.readAsDataURL(file);
                } else {
                    previsualizacionImg.src = '';
                    previsualizacionImg.style.display = 'none';
                }
            });

            document.getElementById('editar-imagen-curso').addEventListener('change', function() {
                const file = this.files[0];
                const previsualizacionImg = document.getElementById('previsualizacion-img-editar-curso');
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previsualizacionImg.src = e.target.result;
                        previsualizacionImg.style.display = 'block';
                    }
                    reader.readAsDataURL(file);
                } else {
                    previsualizacionImg.src = '';
                    previsualizacionImg.style.display = 'none';
                }
            });

            document.getElementById('imagen-enlace').addEventListener('change', function() {
                const file = this.files[0];
                const previsualizacionImg = document.getElementById('previsualizacion-img-enlace');
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previsualizacionImg.src = e.target.result;
                        previsualizacionImg.style.display = 'block';
                    }
                    reader.readAsDataURL(file);
                } else {
                    previsualizacionImg.src = '';
                    previsualizacionImg.style.display = 'none';
                }
            });

            document.getElementById('editar-imagen-enlace').addEventListener('change', function() {
                const file = this.files[0];
                const previsualizacionImg = document.getElementById('previsualizacion-img-editar-enlace');
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previsualizacionImg.src = e.target.result;
                        previsualizacionImg.style.display = 'block';
                    }
                    reader.readAsDataURL(file);
                } else {
                    previsualizacionImg.src = '';
                    previsualizacionImg.style.display = 'none';
                }
            });

            // Inicializar
            window.onload = function() {
                obtenerCursos();
                obtenerVideos();
                obtenerEnlaces();
            };
        </script>
    </div>
</body>
</html>